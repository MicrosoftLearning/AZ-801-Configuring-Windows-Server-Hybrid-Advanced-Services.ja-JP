---
lab:
  title: 'ラボ: ハイブリッド シナリオでの運用監視の実装'
  type: Answer Key
  module: Module 9 - Implementing operational monitoring in hybrid scenarios
---

# ラボの回答キー: ハイブリッド シナリオでの運用監視の実装

## 演習 1: 監視環境の準備

#### タスク 1: Azure 仮想マシンをデプロイする

1. **SEA-SVR2** に接続し、必要に応じて、講師から提供された資格情報でサインインします。
1. **SEA-SVR2** で Microsoft Edge を起動し、Azure portal (`https://portal.azure.com/`) に移動し、このラボで使用するサブスクリプションの所有者ロールを持つユーザー アカウントの資格情報を使用してサインインします。
1. **SEA-SVR2** で、Azure portal を表示している Microsoft Edge ウィンドウで、Azure portal の [Cloud Shell] をクリックして [Azure Cloud Shell] ウィンドウを開きます。
1. **Bash** または **PowerShell** の選択を求めるメッセージが表示されたら、 **[PowerShell]** を選択します。

   > **注**: Cloud Shell を起動するのが初めてで、"**ストレージがマウントされていません**" というメッセージが表示される場合は、このラボで使用しているサブスクリプションを選択し、**[適用]** を選択します。

1. [Cloud Shell] ウィンドウのツールバーで、**[ファイルのアップロード/ダウンロード]** アイコンをクリックし、表示されるボックスの一覧で **[アップロード]** をクリックし、ファイル **C:\\Labfiles\\Lab09\\L09-rg_template.json** を Cloud Shell のホーム ディレクトリにアップロードします。
1.  前の手順を繰り返して、ファイル **C:\Labfiles\Lab09\L09-rg_template.parameters.json** を Cloud Shell のホーム ディレクトリにアップロードします。
1. ラボ環境をホスティングするリソース グループを作成するために、Cloud Shell ウィンドウの **PowerShell** セッションで次のコマンドを入力し、各コマンドの入力後には Enter キーを押します (`<Azure_region>` プレースホルダーを、このラボでリソースをデプロイする Azure リージョンの名前に置き換えます)。

   >**注**: **(Get-AzLocation).Location** コマンドを使用して、使用可能な Azure リージョンの名前を一覧表示できます。

   ```powershell 
   $location = '<Azure_region>'
   $rgName = 'AZ801-L0901-RG'
   New-AzResourceGroup -ResourceGroupName $rgName -Location $location
   ```

1. 新しく作成したリソース グループに Azure 仮想マシンをデプロイするには、次のコマンドを入力し、Enter キーを押します。

   ```powershell 
   New-AzResourceGroupDeployment -Name az801l0901deployment -ResourceGroupName $rgName -TemplateFile ./L09-rg_template.json -TemplateParameterFile ./L09-rg_template.parameters.json -AsJob
   ```
1. メッセージが表示されたら、講師から提供された資格情報を挿入します。

   >**注**: デプロイが完了するのを待たず、代わりに次のタスクに進んでください。 デプロイには約 3 分かかります。

#### タスク 2: Microsoft.Insights と Microsoft.AlertsManagement リソース プロバイダーを登録する

1. Microsoft.Insights と Microsoft.AlertsManagement リソース プロバイダーを登録するには、**SEA-SVR2** で、Cloud Shell ウィンドウから次のコマンドを入力し、各コマンドの入力後には Enter キーを押します。

   ```powershell
   Register-AzResourceProvider -ProviderNamespace Microsoft.Insights
   Register-AzResourceProvider -ProviderNamespace Microsoft.AlertsManagement
   ```

   >**注**: 登録状態を確認するために、**Get-AzResourceProvider** コマンドレットを使用できます。

1. Cloud Shell を閉じます。

   >**注**: 登録プロセスが完了するのを待たずに、次のタスクに進んでください。 登録には約 3 分かかります。

#### タスク 3: Azure Log Analytics ワークスペースを作成して構成する

1. Azure portal の **SEA-SVR2** の **[リソース、サービス、ドキュメントの検索]** ボックスのツールバーで「**Log Analytics ワークスペース**」を検索して選択し、 **[Log Analytics ワークスペース]** ページで **[+ 作成]** を選択します。
1. **[Log Analytics ワークスペースの作成]** ページの **[基本]** タブで、次の設定を入力し、 **[確認と作成]** を選択してから、 **[作成]** を選択します。

   | 設定 | 値 |
   | --- | --- |
   | サブスクリプション | **このラボで使用している Azure サブスクリプションの名前** |
   | リソース グループ | 新しいリソース グループ **AZ801-L0902-RG** の名前 |
   | Log Analytics ワークスペース | **任意の一意の名前** |
   | リージョン | **前のタスクで仮想マシンをデプロイした Azure リージョンの名前** |

   >**注**: デプロイが完了するまで待ちます。 デプロイには約 1 分かかります。

## 演習 2: オンプレミス サーバーの監視の構成

#### タスク 1: Azure Connect Machine エージェントをインストールする

1.  **SEA-SVR2** で、Azure Portal が表示されている Microsoft Edge ウィンドウで、Azure Portal の検索バーに「 **Arc**」と入力し、 **[Azure Arc]** を選択します。 
1.  **[Azure Arc リソース]** の下にあるナビゲーション ウィンドウで  **[マシン]** を選択します
1.   **[+ Add/Create] (+ 追加/作成)** を選択し、ドロップダウンで **[マシンの追加]** を選択します。 
1.  **[単一サーバーの追加]** セクションから  **[スクリプトの生成]**  を選択します。 
1.   **[Azure Arc でサーバーを追加]**  ページの  **[プロジェクトの詳細]** の下で、前の手順で作成したリソース グループ (**AZ801-L0901-RG**) を選択します。 
1.  **[プロジェクトの詳細]** の下で、前のタスクで仮想マシンをデプロイした Azure リージョンの名前を選択します。
1.  SQL Server と接続のオプションを確認します。 **[SQL Server の接続]** をオフにし、残りの既定値をそのまま使用して  **[次へ]** を選択します。 
1.  **[タグ]** タブで、使用可能な既定のタグを確認し、 **[次へ]** を選択します。 
1.  **[Azure Arc でサーバーを追加**] タブで、下にスクロールして **[ダウンロード]**  ボタンを選択します。

      >**注**: ブラウザーがダウンロードをブロックしている場合は、Microsoft Edge ブラウザーで許可します。省略記号ボタン (...) を選択し、 **[保持する]** を選択します。 

1. **Windows の [スタート]** ボタンを右クリックし、 **[Windows PowerShell (管理者)]** を選択します。

   >UAC プロンプトが表示された場合は、講師から提供された資格情報を入力します。 
 
1. 「**cd C:\Users\Administrator.CONTOSO\Downloads**」を入力するか、スクリプトをダウンロードしたフォルダーに移動します。  
1. 次のコマンドを入力して、実行ポリシーを変更します。

   ```powershell 
   Set-ExecutionPolicy -ExecutionPolicy Unrestricted
   ```
1. [すべてにはい] の場合は「A」を入力し、Enter キーを押します。 
1. 次のコマンドを入力し、**Enter** キーを押します。 

   ```powershell 
   .\OnboardingScript.ps1
   ```
1. 「 **R** 」を入力し **1 回実行し**、**Enter **キーを押します (これには数分かかる場合があります)。
セットアップ プロセスにより、Azure Arc エージェントを認証するための新しい Microsoft Edge ブラウザー タブが開きます。 管理者アカウントを選択し、**認証の完了**を示すメッセージが表示されるまで待ちます。 Windows PowerShell に戻り、インストールが完了するまで待ってからウィンドウを閉じます。
1. スクリプトをダウンロードした [Azure portal] ページに戻り、 **[閉じる]** を選択します。
1.  **[Azure Arc でサーバーを追加]**  ページを閉じて、**[Azure Arc マシン]**  ページに戻ります。
1. ARC コンソールで **SEA-SVR2** サーバー名が表示され、[状態] が  **[接続済み]** になるまで  **[更新]** を選択します。

#### タスク 2: 分析情報を使って監視を有効にする

1.  Azure Portal の検索ウィンドウから Azure Arc に移動し、**SEA-SVR2** Azure Arc マシンを選択し、**SEA-SVR2** Arc マシンを開きます。
1.  ナビゲーション ウィンドウの **[監視]** の下で、**[分析情報]** を選択し、**[有効にする]** を選択します。
1.  **[データ収集規則]** の下の **[監視構成]** ページで、**[新規作成]** を選択します。
1.  **[新しいルールの作成]** ページで、次の設定を入力し、**[作成]** を選択します。

      | 設定 | 値 |
      | --- | --- |
      | **データ収集ルール名** | Arc |
      | **プロセスと依存関係を有効にする (マップ)** | Enabled |
      | **サブスクリプション** | このラボで使用している Azure サブスクリプションの名前 |
      | **Log Analytics ワークスペース** | このラボで作成した Log Analytics ワークスペースの名前 |

1.  **[構成]** をクリックします。

   >**注**: このデプロイには数分かかる場合があります。 デプロイが完了するまで待ってから、次の演習を続行します。

#### タスク 3: 監視と診断の設定を有効にする

1.   **SEA-SVR2** で、Azure Portal が表示されている Microsoft Edge ウィンドウにある Azure Portal の検索バーで  **[データ収集ルール]** を検索して選択します。
1.  **[データ収集ルール]** ページで、前の手順で作成した **MSVM1-Arc** データ収集ルールを選択します。
1.  **[構成]** で、**[データ ソース]** を選択し、**[パフォーマンス カウンター]** を選択します。
1.  **[データ ソースの追加]** ページの **[基本]** タブで、**すべて**のパフォーマンス カウンターを選択します。
1.  各カウンターのサンプル レートを 10 秒に変更し、**[保存]** を選択します。
1.  **[監視]** で、**[診断設定]** を選択し、**[+ 診断設定を追加する]** を選択します。
1.  **[診断設定]** の名前に「**ArcDiagSettings**」と入力します。
1.  **[メトリック]** で **[すべてのメトリック]** を選択し、**[宛先の詳細]** で **[Log Analytics ワークスペースへの送信]** を選択します。
1.  このラボで使用している Azure サブスクリプションの名前と、前の手順で作成した Log Analytics ワークスペースを使用します。 **[保存]** を選択し、**[診断設定]** ウィンドウを閉じます。

## 演習 3: 監視サービスを評価する

#### タスク 1: Azure Monitor の監視とアラートの機能を確認する

1.  **SEA-SVR2** で、Azure Portal の **[監視 | アラート]** ページを参照します。
1.  **[+ 作成]** を選択して、**[アラート ルール]** を選択します。
1.  **[リソースの選択]** ページの **[参照]** タブで、**AZ801-L0901-RG** を展開し、**SEA-SVR2** Azure Arc マシンを選択します。 
1. **適用**を選択します。
1.  **[次へ: 条件>]** を選択し、**[アラート ルールの作成]** ページの **[シグナルの選択]** ドロップダウンで、**[カスタム ログ検索]** を選択します。
1.  クエリ ウィンドウに、次の KQL クエリをコピーして貼り付けます。

      ```kql
      // Chart CPU usage trends by computer
      // Calculate CPU usage patterns over the last hour, chart by percentiles.
      InsightsMetrics
      | where TimeGenerated > ago(1h)
      | where Origin == "vm.azm.ms"
      | where Namespace == "Processor"
      | where Name == "UtilizationPercentage"
      | summarize avg(Val) by bin(TimeGenerated, 5m), Computer //split up by computer
      | render timechart
      ```

1.  **[実行]** を選択し、[結果] タブと **[グラフ]** タブにデータを表示します。
1.  [**アラートの編集を続行する**] を選択します。
1.  **[アラート ルールの作成]** ページの **[測定]** で、次の設定を指定して、その他の設定は既定値のままにします。

      | 設定 | 値 |
      | --- | --- |
      | **集計の細分性** | 1 分 |

1.  **[アラート ロジック]** で、次の設定を入力し、**[次へ: アクション >]** を選択します。

      | 設定 | 値 |
      | --- | --- |
      | **Operator** | より大きい |
      | **しきい値** | 10 |
      | **評価の頻度** | 1 分 |

1. **[アラート ルールの作成]** ページの **[アクション]** タブの **[アクションの選択]** セクションで、**[アクション グループの使用]** を選択し、**[アクション グループの選択]** ページで **[アクション グループの作成]** を選択します。
1. **[アクション グループの作成]** ページで次の設定を入力してから、**[次へ: 通知 >]** を選択します。

      | 設定 | 値 |
      | --- | --- |
      | **サブスクリプション** | このラボで使用している Azure サブスクリプションの名前 |
      | **リソース グループ** | AZ801-L0901-RG |
      | **リージョン** | 既定の設定のままにします |
      | **アクション グループ名** | 任意の一意の名前 |
      | **[表示名]** | 任意の一意の名前 (12 文字以下) |

1. **[アクション グループの作成]** ページの **[通知の種類]** で、**[Azure Resource Manager のロールへのメール]** を選択し、**"名前"** フィールドに**管理者のメール アドレス**を入力します。
1. **[Azure Resource Manager のロールへのメール]** ページで、ドロップダウン リストから **[オーナー]** を選択し、**[OK]** をクリックします。
1.  **[アクション グループの作成]** ページで、**[確認と作成]** を選択してから、**[作成]** を選択します。

      >**注**: メトリックのアラート ルールがアクティブになるまでに最大 10 分かかることがあります。

1.  **[アラート ルールの作成]** ページで、**[次へ: 詳細 >]** を選択します。
1.  既定の設定のままにしますが、**[アラート ルールの詳細]** で、アラート ルールの名前と説明に「**High CPU アラート**」と入力します。
1.  **[確認および作成]** を選択し、 **[作成]** を選択します。
1.  **SEA-SVR2** Azure Arc マシンを参照し、**Windows の [スタート]** ボタンを右クリックし、 **[Windows PowerShell (管理者)]** を選択します。
1. 次のコマンドを入力し、**Enter** キーをクリックします。

   ```powershell 
   $vCpuCount = Get-WmiObject Win32_Processor | Select-Object -ExpandProperty NumberOfLogicalProcessors
      ForEach ($vCpu in 1..$vCpuCount){ 
         Start-Job -ScriptBlock{
            $result = 1;
            ForEach ($loopCount in 1..2147483647){
               $result = $result * $loopCount
            }
      }
   }
   ```

1.  **SEA-SVR2** の、Azure portal を表示している Microsoft Edge ウィンドウで、別のタブを開き、**[モニター]** ページを参照し、**[アラート]** を選択します。

      >**注**: 数分待ってからモニター | アラート ページを更新する必要がある場合があります。

## 演習 4: Azure VM の監視を構成する

#### タスク 1: 診断設定と VM 分析情報を構成する

1.   **SEA-SVR2** で、Azure Portal が表示されている Microsoft Edge ウィンドウの Azure portal の検索バーで、**仮想マシン** を検索し、 **az801l09-vm0** を選択します。
1.  **[az801l09-vm0]** ページの **[監視]** で **[診断設定]** を選択します。
1.  **[診断設定]** タブで、ドロップダウン リストから [診断ストレージ アカウント] を選択し、**[ゲスト レベルの監視を有効にする]** を選択します。

      >**注**: 操作が有効になるのを待ちます。 これには 3 分ほどかかる場合があります。

1.  **[az801l09-vm0 | 診断設定]** ページの **[パフォーマンス カウンター]** タブに切り替え、使用可能なカウンターを確認します。

      >**注**: 既定では、CPU、メモリ、ディスク、ネットワークのカウンターが有効になっています。 **[カスタム] ビュー**に切り替えると、より詳細な一覧を確認できます。

1.  **[az801l09-vm0 | 診断設定]** ページの **[ログ]** タブで、使用可能なイベント ログ収集のオプションを確認します。

      >**注**: 既定では、ログの収集には、アプリケーション ログとシステム ログからの重大、エラー、および警告のエントリに加え、セキュリティ ログからの監査失敗のエントリが含まれています。 これらは、**[ログ]** タブでカスタマイズできます。

#### タスク 2: VM 分析情報の有効化

1.  左側にある垂直メニューの **[監視]** セクションから、**[az801l09-vm0 | 分析情報]** ページを参照します。
1.  **[az801l09-vm0 | 分析情報]** ページで、**[有効化]** を選択します。

      >**注**: この設定により、Azure VM Insights 機能が提供されます。 VM Insights は、Azure Monitor のソリューションの 1 つで、これにより、Windows または Linux を実行する Azure VM とオンプレミス コンピューターの両方のパフォーマンスと正常性の監視が容易になります。

1.  **[監視構成]** ページの **[データ収集ルール]** で、**[新規作成]** を選択し、[名前] フィールドに「**AZ801vm0**」と入力します。
1.  **[プロセスと依存関係]** の下で、**[プロセスと依存関係を有効にする (マップ)]** を選択します。
1.  このラボで使用している Azure サブスクリプションの名前のままにします。
1.  **[Log Analytics ワークスペース]** ドロップダウン メニューで、前の手順で作成した [Log Analytics ワークスペース] を選択します。
1.  **[作成]** を選択し、**[設定]** を選択します。

      >**注**: このオプションにより、正常性モデルを使用した監視とアラートの機能が有効になります。これは、Azure Monitor for VMs によって生成されたメトリックを使用して構築される正常性監視の階層構造となっています。
      この展開には時間がかかる場合があります。 デプロイが完了するのを待ち、プロセス マップに戻ってからラボを終了します。 これにより、プロセス マップのデータを確認できます。 

## 演習 5: 監視サービスを評価する

#### タスク 1: Azure Monitor の監視とアラートの機能を確認する

1. **SEA-SVR2** の Azure Portal で、**[モニター \| 分析情報]** ページを参照し、**[分析情報]** で **[仮想マシン]** を選択します。 **[モニター | 仮想マシン]** ページで、**[パフォーマンス]** タブを選択すると、**CPU/メモリ** 使用率などのカテゴリが表示されます。
1.  **[監視 | アラート]** ページで **[+ 作成]** を選択し、**[アラート ルール]** を選択します。
1.  **[リソースの選択]** ページで、**AZ801-L0901-RG** リソース グループを展開し、**az801l09-vm0** を選択して、**[適用]** をクリックします。 
1. **[次へ: 条件 >]** を選択します。
1.  **[シグナル]** ドロップダウン リストから **[CPU 使用率]** を選択します。
1.  **[アラート ロジック]** セクションで、次の設定を指定し (他は既定値のままにします)、**[次へ: アクション >]** を選択します。

      | 設定 | 値 |
      | --- | --- |
      | しきい値タイプ | **Static** |
      | 集計の種類 | **Average** |
      | 値は | **より大きい** |
      | しきい値 | "**10**" |
      | 確認する間隔 | **1 分** |
      | ルックバック期間 | **1 分** |

1.  **[アラート ルールの作成]** ページの **[アクション]** タブで、**[+ アクション グループの追加]** ボタンを選択します。
1.  **[アクション グループの作成]** ページの **[基本]** タブで、次の設定を指定し (他の設定は既定値のままにして)、 **[次へ: 通知 >]** を選択します。

      | 設定 | 値 |
      | --- | --- |
      | サブスクリプション | このラボで使用している Azure サブスクリプションの名前 |
      | リソース グループ | **AZ801-L0902-RG** |
      | アクション グループ名 | **az801l09-ag1** |
      | 表示名 | **az801l09-ag1** |

1.  **[アクション グループの作成]** ページの **[通知]** タブにある **[通知の種類]** ドロップダウン リストで **[電子メール/Azure Resource Manager のロール]** を選択します。 **[名前]** テキスト ボックスに「**admin email notification**」と入力し、**詳細の編集** (鉛筆) アイコンを選択します。
1.  **[Azure Resource Manager のロールへのメール]** で **[共同作成者]** を選択し、**[OK]** をクリックします。
1.  **[アクション グループの作成]** ページで、**[確認と作成]** を選択してから、**[作成]** を選択します。

      >**注**: メトリックのアラート ルールがアクティブになるまでに最大 10 分かかることがあります。

1.  **[アラート ルールの作成]** ページに戻り、**[次へ: 詳細 >]** を選択し、**[アラート ルールの詳細]** セクションで、次の設定を指定します (他の設定は既定値のままにします)。

      | 設定 | 値 |
      | --- | --- |
      | リソース グループ | **AZ801-L0902-RG** |
      | 重要度 | **3 - 情報** |
      | アラート ルール名 | **テストしきい値を超えた CPU の割合** |
      | 説明 | **テストしきい値を超えた CPU の割合** |
      | 作成時に有効化 | **はい** |

      >**注**: **[作成時に有効化]** フィールドが表示されない場合は、**[詳細オプション]** セクションを展開します。

1.  **[確認および作成]** を選択し、 **[作成]** を選択します。
1.  Azure portal で、「**仮想マシン**」を検索して選択し、**[仮想マシン]** ページで **az801l09-vm0** を選択します。
1. **[az801l09-vm0]** ページの **[操作]** セクションで **[コマンドの実行]** を選択し、**[RunPowerShellScript]** を選択します。
1. **[コマンドの実行]** ページで **RunPowerShellScript** を選択し、次のコマンドを入力して **[実行]** を選択し、ターゲット オペレーティング システム内の **CPU 使用率**を増やします。

   >**注**: スクリプトを最初にメモ帳にコピーし、スクリプト ウィンドウに貼り付けてからスクリプトを実行します。

      ```powershell 
      $vCpuCount = Get-WmiObject Win32_Processor | Select-Object -ExpandProperty NumberOfLogicalProcessors
         ForEach ($vCpu in 1..$vCpuCount){ 
            Start-Job -ScriptBlock{
               $result = 1;
               ForEach ($loopCount in 1..2147483647){
                  $result = $result * $loopCount
               }
         }
      }
      ```

   >**注**: これにより、CPU 使用率が、新しく作成されたアラート ルールのしきい値を超えて増加します。 これには数分かかることがあります。

1.  **SEA-SVR2** の、Azure portal を表示している Microsoft Edge ウィンドウで、別のタブを開き、**az801l09-vm0** 仮想マシン ページを参照し、**[監視 | アラート]** ページを参照します。 **Sev 3** アラート の数を確認してから **[Sev 3]** 行を選択します。

      >**注**: 数分待ってから **[更新]** を選択する必要がある場合があります。 時間がかかる場合は、ラボを続行して **[監視 | アラート]** ページに戻り、後でデータを表示します。

1.  **[テストしきい値を超えた CPU 使用率]** ページで、生成されたアラートを確認します。 レビューが完了したら、ページを閉じます。


#### タスク 2: Azure Monitor の VM Insights 機能を確認する

1. **SEA-SVR2** で、Azure portal の **az801l09-vm0** 仮想マシンのページに戻ります。
1. **az801l09-vm0** 仮想マシンのページの左側にある垂直メニューで、**[監視]** セクションの **[Insights]** を選択します。
1. **[az801l09-vm0 \| Insights]** ページの **[パフォーマンス]** タブで、論理ディスクのパフォーマンス、CPU 使用率、使用可能なメモリ、送受信バイト数など、メトリックの既定のセットを確認します。
1. **[az801l09-vm0 \| Insights]** ページで **[マップ]** タブを選択し、自動生成されたマップを確認します。
1. **[az801l09-vm0 \| Insights]** ページで **[正常性]** タブを選択し、その内容を確認します。

   >**注**: 正常性情報を使用できるかどうかは、ワークスペースのアップグレードが完了しているかどうかによって異なります。

#### タスク 3: Azure Log Analytics の機能を確認する

1. **SEA-SVR2** で、Azure portal の **[モニター]** ページに戻り、 **[ログ]** を選びます。
1. **[新しいクエリ 1]** ページで、**[スコープの選択]** をクリックします。 
1. **[スコープの選択]** ページで、**[参照]** タブを選択し、このラボで先ほど作成した一意のワークスペースを選択して、**[適用]** を選択します。
1. クエリ ウィンドウで、次のクエリを貼り付け、 **[実行]** をクリックし、結果のグラフを確認します。

   ```kql
   // Virtual Machine available memory
   // Chart the VM's available memory over the last hour.
   InsightsMetrics
   | where TimeGenerated > ago(1h)
   | where Name == "AvailableMB"
   | project TimeGenerated, Name, Val
   | render timechart
   ```

1. **[新しいクエリ 1]** タブの **[テーブル]** ヘッダーを選択し、**[Azure Resources]** セクションでテーブルの一覧を確認します。

   >**注**: いくつかのテーブルの名前は、このラボで以前にインストールしたソリューションに対応しています。 特に、**InsightMetrics** は、パフォーマンス メトリックを格納するために Azure VM Insights で使用されます。

1. **VMComputer** エントリの上にカーソルを置き、**[プレビュー データの表示]** アイコンを選択し、結果を確認します。

   >**注**: **az801l09-vm0** と **SEA-SVR2.contoso.com** の両方のエントリがデータに含まれていることを確認してください。

   >**注**: 更新データが使用可能になる前に、数分待つ必要がある場合があります。

## 演習 6: Azure 環境のプロビジョニング解除

#### タスク 1: Cloud Shell で PowerShell セッションを開始する

1. **SEA-SVR2** で、Azure portal を表示している Microsoft Edge ウィンドウにある [**Cloud Shell**] アイコンを選んで Cloud Shell ウィンドウを開きます。

#### タスク 2: ラボでプロビジョニングされたすべての Azure リソースを削除する

1. Cloud Shell ウィンドウで次のコマンドを実行して、このラボで作成されたすべてのリソース グループの一覧を表示します。

   ```powershell
   Get-AzResourceGroup -Name 'AZ801-L09*'
   ```

   > **注**: 出力に含まれているのが、このラボで作成したリソース グループのみであることを確認してください。 このグループが、このタスクで削除されます。

1. 次のコマンドを実行して、このラボで作成したすべてのリソース グループを削除します。

   ```powershell
   Get-AzResourceGroup -Name 'AZ801-L09*' | Remove-AzResourceGroup -Force -AsJob
   ```

   >**注**: このコマンドは非同期 (*-AsJob* パラメーターによって決定されます) で実行されます。 そのため、同じ PowerShell セッション内で、すぐに別の PowerShell コマンドを実行できるようになりますが、リソース グループが実際に削除されるまでに数分かかります。
