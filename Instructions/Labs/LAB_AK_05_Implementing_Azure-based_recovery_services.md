---
lab:
  title: 'ラボ: Azure ベースの復旧サービスの実装'
  type: Answer Key
  module: 'Module 5: Planning and implementing migration and recovery services in hybrid scenarios'
ms.openlocfilehash: 57aeb2d0bbcc6a67e44e5f22a874959c6ae9e1e0
ms.sourcegitcommit: 9a51ea796ef3806ab9e7ec1ff75034b2f929ed2a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/28/2022
ms.locfileid: "137907143"
---
# <a name="lab-answer-key-implementing-azure-based-recovery-services"></a>ラボの回答キー: Azure ベースの復旧サービスの実装

## <a name="exercise-1-creating-and-configuring-an-azure-site-recovery-vault"></a>演習 1: Azure Site Recovery コンテナーの作成と構成

#### <a name="task-1-create-an-azure-site-recovery-vault"></a>タスク 1: Azure Site Recovery コンテナーの作成

1. **SEA-SVR2** に接続し、必要であればパスワード **Pa55w.rd** を使用して **CONTOSO\\Administrator** としてサインインします。
1. **SEA-SVR2** で Microsoft Edge を起動し、 **[Azure portal](https://portal.azure.com)** に移動し、 このラボで使用するサブスクリプションの所有者ロールをもつユーザー アカウントの資格情報を使用してサインインします。
1. Azure portal の **[リソース、サービス、ドキュメントの検索]** テキスト ボックスで、ツール バーで **Recovery Services コンテナー** を検索して選択し、 **[Recovery Services コンテナー]** ページで **[+ 作成]** を選択します。
1. **[Recovery Services コンテナーの作成]** ページの **[基本]** タブで、次の設定を指定し (他の設定は既定値のままにして)、 **[確認と作成]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用する Azure サブスクリプションの名前|
   |リソース グループ|新しいリソース グループの名前 **AZ801-L0501-RG**|
   |コンテナー名|**az801l05a-rsvault**|
   |場所|Azure Recovery Services コンテナーを作成できる Azure リージョンの名前 (ラボ環境の場所に近い)|

1. **[Recovery Services コンテナーの作成]** ページ の **[確認と作成]** タブで、 **[作成]** を 選択します。

   > **メモ：** Recovery Services コンテナーがプロビジョニングされるまで待ちます。 これには 2 分ほどかかります。

   > **メモ：** 既定では、コンテナーの [ストレージ レプリケーションの種類] は [geo 冗長 (GRS)] に設定され、[論理的な削除] と [セキュリティ機能] が有効になっています。 ラボでは、プロビジョニング解除を簡略化するためにこれらの設定を変更しますが、実稼働環境では有効になっている必要があります。

#### <a name="task-2-configure-the-azure-site-recovery-vault"></a>タスク 2: Azure Site Recovery コンテナーの構成

1. **SEA-SVR2** で、Azure portal を表示している Microsoft Edge ウィンドウ内のデプロイ ページで **[リソースに移動]** を選択します。 

   > **メモ：** これにより、 **[az801l05a-rsvault]** ページが自動的に表示されます。

1. **[az801l05a`-rsvault]** ページの左側の垂直メニューの **[設定]** セクションで、 **[プロパティ]** を選択します。 
1. **[az801l05a-rsvault | プロパティ]** ページの **[バックアップ構成]** ラベルの下にある **[更新]** リンクを選択します。
1. **[バックアップ構成]** ページで、 **[ストレージ レプリケーションの種類]** を **[ローカル冗長]** に設定し、 **[保存]** を選択して **[バックアップ構成]** ページを閉じます。

   > **メモ:** [ストレージ レプリケーションの種類] は、保護を実装した後では変更できません。

1. **[az801l05a-rsvault | プロパティ]** ページの **[セキュリティの設定]** ラベルの下にある **[更新]** リンクを選択します。
1. **[セキュリティ設定]** ページで **[論理的な削除]** を **[無効]** に、 **[セキュリティ機能]** を **[無効]** に設定し、 **[保存]** を選択し、その後 **[セキュリティ設定]** ページを閉じます。

## <a name="exercise-2-implementing-hyper-v-vm-protection-by-using-azure-site-recovery-vault"></a>演習 2: Azure Site Recovery コンテナーを使った Hyper-V VM 保護の実装

#### <a name="task-1-implement-an-azure-recovery-site"></a>タスク 1: Azure 復旧サイトの実装

1. **SEA-SVR2** で、Azure portal が表示されている Microsoft Edge ウィンドウで、ツール バーの **[リソース、サービス、ドキュメントの検索]** テキスト ボックスを使用して **[仮想ネットワーク]** を検索して選択し、 **[仮想ネットワーク]** ページで **[+ 作成]** を選択します。
1. **[仮想ネットワークの作成]** ページの **[基本]** タブで、次の設定を指定し (他の設定は既定値のままにして)、 **[次へ: IP アドレス]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
   |リソース グループ|新しいリソース グループの名前 **AZ801-L0502-RG**|
   |名前|**az801l05-dr-vnet**|
   |リージョン|このラボの前半で Recovery Services コンテナーをデプロイした Azure リージョンの名前|

1. **[仮想ネットワークの作成]** ページの **[IP アドレス]** タブで、ごみ箱アイコンを選択し、**[IPv4 アドレス空間]** テキスト ボックスに「**10.5.0.0/22**」と入力し、**[+ サブネットの追加]** を選択します。
1. **[サブネットの追加]** ページで、次の設定を指定し (他の設定は既定値のまま)、 **[追加]** を選択します。

   |設定|値|
   |---|---|
   |サブネット名|**subnet0**|
   |サブネットのアドレス範囲|**10.5.0.0/24**|

1. **[仮想ネットワークの作成]** ページの **[IP アドレス]** タブに戻り、 **[確認と作成]** を選択します。
1. **[仮想ネットワークの作成]** ページの **[確認と作成]** タブで、 **[確認]** を選択します。
1. **SEA-SVR2** の Azure portal で **[仮想ネットワーク]** ページに戻り、 **[+ 作成]** を選択します。
1. **[仮想ネットワークの作成]** ページの **[基本]** タブで、次の設定を指定し (他の設定は既定値のままにして)、 **[次へ: IP アドレス]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
   |リソース グループ|**AZ801-L0502-RG**|
   |名前|**az801l05-test-vnet**|
   |リージョン|このラボの前半で Recovery Services コンテナーをデプロイした Azure リージョンの名前|

1. **[仮想ネットワークの作成]** ページの **[IP アドレス]** タブで、ごみ箱アイコンを選択し、**[IPv4 アドレス空間]** テキスト ボックスに「**10.5.0.0/22**」と入力し、**[+ サブネットの追加]** を選択します。

   > **メモ：** IP アドレス空間の重複に関する警告は無視します。 これは意図的なものであり、テスト環境の IP アドレス空間はディザスター リカバリー環境の IP アドレス空間と一致します。

1. **[サブネットの追加]** ページで、次の設定を指定し (他の設定は既定値のまま)、 **[追加]** を選択します。

   |設定|値|
   |---|---|
   |サブネット名|**subnet0**|
   |サブネットのアドレス範囲|**10.5.0.0/24**|

1. **[仮想ネットワークの作成]** ページの **[IP アドレス]** タブに戻り、 **[確認と作成]** を選択します。
1. **[仮想ネットワークの作成]** ページの **[確認と作成]** タブで、 **[確認]** を選択します。
1. **SEA-SVR2** の Azure portal で、ツール バーの **[リソース、サービス、ドキュメントの検索]** テキスト ボックスを使用して **[ストレージ アカウント]** を検索して選択し、 **[ストレージ アカウント]** ページで **[+ 作成]** を選択します。
1. **[ストレージ アカウントの作成]** ページの **[基本]** タブで、以下の設定を指定します (その他の設定は既定値のままにしておきます)。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
   |リソース グループ|**AZ801-L0502-RG**|
   |ストレージ アカウント名|3 文字から 24 文字の長さで、アルファベットと数字で構成され、アルファベットで始まる、グローバルに一意の任意の名前|
   |リージョン|このラボの前半で Recovery Services コンテナーをデプロイした Azure リージョンの名前|
   |パフォーマンス|Standard|
   |冗長性|ローカル冗長ストレージ (LRS)|

1. **[ストレージ アカウントの作成]** ページの **[基本]** タブで、 **[データ保護]** タブを選択します。
1. **[ストレージ アカウントの作成]** ページの **[データ保護]** タブで、 **[BLOB の論理的な削除を有効にする]** チェック ボックスと **[コンテナーの論理的な削除を有効にする]** チェック ボックスをオフにして、 **[確認と作成]** を選択します。

   > **メモ：** Azure Site Recovery 用のストレージ アカウントを使用する場合は、これらの設定を無効にする必要があります。

1. **[ストレージ アカウントの作成]** ページの **[確認と作成]** タブで、 **[作成]** を選択します。

#### <a name="task-2-prepare-protection-of-a-hyper-v-virtual-machine"></a>タスク 2: Hyper-V 仮想マシンの保護の準備

1. **SEA-SVR2** の Microsoft Edge ウィンドウで Azure portal を表示し、ツール バーの **[リソース、サービス、ドキュメントの検索]** テキスト ボックスを使用して **[リソース、サービス、ドキュメントの検索]** コンテナーを検索して選択し、 **[Recovery Services コンテナー]** ページで **[az801l05a-rsvault]** エントリを選択します。
1. **[az801l05a`-rsvault]** ページの左側の垂直メニューの **[作業の開始]** セクションで、 **[Site Recovery]** を選択します。
1. **az801l05a-rsvault\| Site Recovery** ページの [**Hyper-V マシンを Azure に]** セクションで、 **[1. インフラストラクチャの準備]** を選択します。 
1. **[インフラストラクチャの準備]** ページの **[デプロイ計画]** タブの **[デプロイ計画が完了しましたか?]** ドロップダウン リストで、 **[はい、完了しました]** を選択し、 **[次へ]** を選択します。
1. **[インフラストラクチャの準備]** ページの **[ソースの設定]** タブの **[System Center VMM を使用して Hyper-V ホストを管理していますか?]** ラベルの横の **[いいえ]** オプションを選択します。
1. **[インフラストラクチャの準備]** ページの **[ソースの設定]** タブで、 **[Hyper-V サイトの追加]** リンクを選択します。 
1. **[Hyper-V サイトの作成]** ページの **[名前]** テキスト ボックスに「**az801l05-site**」と入力し、**[OK]** を選択します。
1. **[インフラストラクチャの準備]** ページの **[ソースの設定]** タブで、 **[Hyper-V サーバーの追加]** リンクを選択します。 
1. **[サーバーの追加]** ページで、オンプレミスの Hyper-V ホストを追加する手順の手順 3 の **[ダウンロード]** リンクを選択して、Microsoft Azure Site Recovery Provider のインストーラーをダウンロードします。

   > **メモ：**「**AzureSiteRecoveryProvider.exe を安全にダウンロードできない**」という Microsoft Edge の通知が表示される場合は、メッセージの右側にカーソルを移動して省略記号 (**...**) を表示し、それを選択します。ドロップダウン メニューで **[ダウンロード リンクのコピー]** を選択し、同じ Microsoft Edge ウィンドウで別のタブを開き、コピーしたリンクを貼り付け、Enter キーを押します。

1. ダウンロード完了の通知に対して **[ファイルを開く]** を選択します。 これにより、Azure Site Recovery **[Azure Site Recovery Provider のセットアップ (Hyper-V サーバー)]** ウィザードが起動します。
1. **[Microsoft Update]** のページで **[オフ]** を選択し、 **[次へ]** を選択します。
1. **[プロバイダーのインストール]** ページで **[インストール]** を選択します。
1. Azure portal が表示されている Microsoft Edge ウィンドウに切り替え、[サーバーの追加] ページで、オンプレミスの Hyper-V ホストを登録する手順の手順 4 の **[ダウンロード]** ボタンを選択して、コンテナー登録キーをダウンロードします。
1. **[プロバイダーのインストール]** ウィザード に切り替え、 **[登録]** を選択します。 これにより、 **[Microsoft Azure Site Recovery 登録ウィザード]** が起動します。
1. **[Microsoft Azure Site Recovery 登録ウィザード]** の **[コンテナー設定]** ページで **[参照]** を選択します。 
1. **[開く]** ウィンドウで **[ダウンロード]** フォルダーを参照 し、コンテナーの資格情報ファイルを選択して、 **[開く]** を選択します。
1. **[Microsoft Azure Site Recovery 登録ウィザード]** の **[コンテナー設定]** ページに戻り、 **[次へ]** を選択します。
1. **[Microsoft Azure Site Recovery 登録ウィザード]** の **[プロキシ設定]** ページで既定の設定を受け入れ、 **[次へ]** を選択します。
1. **[Microsoft Azure Site Recovery 登録ウィザード]** の **[登録]** ページで **[完了]** を選択します。

   > **メモ：** 登録が失敗する場合は、 **[開始]** を選択します。 **[開始]** メニューで **[Azure Site Recovery プロバイダー]** フォルダーを選択します。 そのフォルダーで **[Azure Site Recovery コンフィギュレーター]** を選択し、登録手順を再度実行します。

1. Azure portal を表示している Microsoft Edge ウィンドウに戻り、 **[サーバーの追加]** ページを閉じて、ページを最新の情報に更新します。 プロンプトが表示されたら、 **[リロード]** を選択します。 
1. **[az801l05a-rsvault | Site Recovery]** ページの **[Hyper-V マシンを Azure に]** セクションで、 **[1. インフラストラクチャの準備]** を選択します。 
1. **[インフラストラクチャの準備]** ページの **[デプロイ計画]** タブの **[デプロイ計画が完了しましたか?]** ドロップダウン リストで、 **[はい、完了しました]** を選択し、 **[次へ]** を選択します。
1. **[インフラストラクチャの準備]** ページの **[ソースの設定]** タブの **[System Center VMM を使用して Hyper-V ホストを管理していますか?]** ラベルの横の **[いいえ]** オプションを選択します。
**[Hyper-V サイト]** と **[HHyper-V サーバー]** の設定が正しく設定されていることを確認し、 **[次へ]** を選択します。 
1. **[インフラストラクチャの準備]** ページの **[ターゲット設定]** タブ で、既定の設定を受け入れ、 **[次へ]** を選択します。
1. **[インフラストラクチャの準備]** ページの **[レプリケーション ポリシー]** タブで、 **[新しいポリシーの作成と関連付け]** を選択します。 
1. **[ポリシーの作成と関連付け]** ページで、次の設定を指定し (他の設定は既定値のまま)、 **[OK]** を選択します。

   |設定|値|
   |---|---|
   |名前|**az801l05-replication-policy**|
   |コピーの頻度|**30 秒**|

1. **[インフラストラクチャの準備]** ページの **[レプリケーション ポリシー]** タブに戻り、 サイトがポリシーに関連付けられるまで待ち、 **[次へ]** を選択します。
1. **[インフラストラクチャの準備]** ページの **[確認]** タブで、 **[準備]** を選択します。

#### <a name="task-3-enable-replication-of-a-hyper-v-virtual-machine"></a>タスク 3: Hyper-V 仮想マシンのレプリケーションの有効化

1. **SEA-SVR2** で、Azure portal が表示されている Microsoft Edge ウィンドウの [**az801l05a-rsvault \| Site Recovery**] ページの **Hyper-V マシンを Azure に]** [ セクションで、] **[2. レプリケーションを有効にする** を選択します。 
1. **[レプリケーションの有効化]** ページの **[ソース環境]** タブの **[ソースの場所]** ドロップダウン リストで、 **[az801l05-site]** を選択し、 **[次へ]** を選択します。
1. **[レプリケーションの有効化]** ページの **[ターゲット環境]** タブで、次の設定を指定し (他の設定は既定値のままにして)、 **[次へ]** を選択します。

   |設定|値|
   |---|---|
   |サブスクリプション|このラボで使用している Azure サブスクリプションの名前|
   |フェールオーバー後のリソース グループ|**AZ801-L0502-RG**|
   |フェールオーバー後のデプロイ モデル|**Resource Manager**|
   |ストレージ アカウント|この演習の最初のタスクで作成したストレージ アカウントの名前|
   |Azure ネットワーク|選択したマシン用に今すぐ構成する|
   |仮想ネットワーク|**az801l05-dr-vnet**|
   |サブネット|**subnet0 (10.5.0.0/24)**|

1. **[レプリケーションの有効化]** ページの **[仮想マシンの選択]** タブで、 **[SEA-CORE1]** チェック ボックスをオンにして、 **[次へ]** を選択します。
1. **[レプリケーションの有効化]** ページの **[レプリケーションの設定]** タブの **[既定]** 行と **[OSの種類]** 列で、ドロップダウン リストから **[Windows]** を選択し、 **[次へ]** を選択します。
1. **[レプリケーションの有効化]** ページの **[レプリケーション ポリシー ]** タブ で、既定の設定を受け入れ、 **[次へ]** を選択します。
1. **[レプリケーションの有効化]** ページの **[確認]** タブで、 **[レプリケーションの有効化]** を選択します。

#### <a name="task-4-review-azure-vm-replication-settings"></a>タスク 4: Azure VM のレプリケーション設定の確認

1. **SEA-SVR2** で、Azure portal を表示している Microsoft Edge ウィンドウで、左側の垂直メニューの [**az801l05a-rsvault \| Site Recovery**] ページに戻り、 **[レプリケートされた項目]** を選択します。 
1. **[az801l05a-rsvault \| レプリケートされた項目]** ページで、 **[SEA-CORE1]** 仮想マシンを表すエントリが表示され、その **[レプリケーション ヘルス]** が **[正常]** と表示され、その **[状態]** が **[保護を有効化中]** または同期の進行状況の現在の割合として表示されることを確認します。

   > **メモ：** [**az801l05a-rsvault**  レプリケートされた項目 **] ページに \|[SEA-CORE1]** エントリが表示されるまで、数分待つ必要があります。

1. **[az801l05a-rsvault \| レプリケートされた項目]** ページで、 **[SEA-CORE1]** エントリを選択します。
1. **[SEA-CORE1**  レプリケートされた項目] ページで、 **[正常性と状態]** セクション、 **[フェールオーバーの準備]** セクション、 **[最新の復旧ポイント]** セクション、 **[インフラストラクチャ ビュー]** セクションを確認します。 **[計画フェールオーバー]** 、 **[フェールオーバー]** 、 **[テスト フェールオーバー]** のツールバー アイコンに注意してください。

   > **注:** 状態が **[保護されている]** に変わるまで待ちます。 こうなるのに必要な時間は、ラボ環境と Recovery Services コンテナーをホストしている Azure リージョン間の接続の使用可能な帯域幅によって異なります。 ブラウザー ページを最新の状態に更新して、状態が更新されたかを確認する必要があります。 

1. **[SEA-CORE1**  レプリケートされた項目] ページで、 **[最新の復旧ポイント]** を選択し、 **[最新のクラッシュ整合性]** と **[最新のアプリ整合性]** の復旧ポイントを確認します。 

#### <a name="task-5-perform-a-failover-of-the-hyper-v-virtual-machine"></a>タスク 5: Hyper-V 仮想マシンのフェールオーバーの実行

1. **SEA-SVR2** で Azure portal が表示されている Microsoft Edge ウィンドウで、 **[SEA-CORE1**  レプリケートされた項目] ページに戻り、 **[テスト フェールオーバー]** を選択します。 
1. **[テスト フェールオーバー]** ページで、次の設定を指定し (他の設定は既定値のまま)、 **[OK]** を選択します。

   |設定|値|
   |---|---|
   |復元ポイントの選択|既定のオプション|
   |Azure の仮想ネットワーク|**az801l05-test-vnet**|

1. Azure portal で **[az801l05a-rsvault]** ページに戻り、左側の垂直メニューの **監視]** [ セクションで ] **[Site Recovery ジョブ** を選択します。 **[テスト フェールオーバー]** ジョブの状態が **[成功]** と表示されるまで待ちます。

   > **注:** テスト フェールオーバーが完了するのに必要な時間は、ラボ環境と Recovery Services コンテナーをホストしている Azure リージョン間の接続の使用可能な帯域幅によって異なります。 ブラウザー ページを最新の状態に更新して、状態が更新されたかを確認する必要があります。 

   > **メモ：** テスト フェールオーバーが完了するのを待っている間に、演習 3 に進み、完了したら、この演習の残りの部分を手順に従って実行します。

1. Azure portal で、ツールバーの **[リソース、サービス、ドキュメントの検索]** テキスト ボックスを使用して **[仮想マシン]** を検索して選択し、 **[仮想マシン]** ページで、新しくプロビジョニングされた仮想マシンを表すエントリに着目します。

   > **メモ:** 仮想マシンの名前は、最初は **asr-** プレフィックスとランダムに生成されたサフィックスで構成されますが、最終的には **SEA-CORE1-test** に名前が変更されます。

1. Azure portal で、 **[SEA-CORE1**  レプリケートされた項目] ページに戻り、 **[テスト フェールオーバーのクリーンアップ]** を選択します。
1. **[テスト フェールオーバーのクリーンアップ]** ページ で、 **[テストが完了しました。テスト フェールオーバー仮想マシンを削除してください。]** チェック ボックスをオンにして、 **[OK]** を選択します。
1. テスト フェールオーバー クリーンアップ ジョブが完了したら、 [**SEA-CORE1**  レプリケートされた項目] ページが表示されているブラウザー ページを最新の情報に更新し、計画されたフェールオーバーと計画外のフェールオーバーを実行するオプションがあることに着目してください (後者には **[フェールオーバー]** というラベルが付いています)。

   > **メモ：** 計画外のフェールオーバー オプションには、 **[フェールオーバー]** というラベルが付いています。

1. **[SEA-CORE1**  レプリケートされた項目] ページで、 **[計画フェールオーバー]** を選択します。 
1. **[計画フェールオーバー]** ページ で、フェールオーバーの方向の設定が既に設定され、変更できない点に注意してください。 
1. フェールオーバーを開始しないでに **[計画フェールオーバー]** ページを閉じ、 **[SEA-CORE1**  レプリケートされた項目] ページで **[フェールオーバー]** を選択します。 
1. **[フェールオーバー]** ページには、復旧ポイントを選択するオプションがある点に着目してください。 
1. フェールオーバーを開始しないで **[フェールオーバー]** ページを閉じます。

## <a name="exercise-3-implementing-azure-backup"></a>演習 3: Azure Backup の実装

#### <a name="task-1-set-up-the-azure-recovery-services-agent"></a>タスク 1: Azure Recovery Services エージェントの設定

> **注：** 一般に、同じコンテナーを使用して、Azure Site Recovery と Azure Backup 機能を実装できます。 ディザスター リカバリーとバックアップの目的でコンテナーをホストする Azure リージョンを選択する場合は、リージョンの災害の影響範囲やネットワーク待機時間に関する考慮事項など、復旧目標を考慮する必要があります。 このラボでは、サイトの復旧とバックアップに同じコンテナーを使用して、重複する手順の数を最小限にします。 

> **注：** Azure Backup を実装するには、**SEA-SVR2** に AZURE Recovery Services エージェントをインストールします。このエージェントは、既に **Microsoft Azure Site Recovery プロバイダー** として機能するものです。 依存関係の問題を解消するため、最初に、既存のインストール済み Azure Recovery Services エージェントをアンインストールします。

1. **SEA-SVR2** で **[スタート]** を選択し、 **[スタート]** メニューで **[設定]** アプリを選択します。
1. **[設定]** アプリで **[アプリ]** を選択します。
1. [アプリと&機能] ウィンドウで **[Microsoft Azure Recovery Services エージェント]** を選択し、 **[アンインストール]** を選択して、画面の指示に従ってアンインストールします。
   > **メモ：** 「インストールが失敗した」というエラー メッセージが表示される場合は、VM を再起動してから、もう一度やり直してください。 
1. **SEA-SVR2** で Azure portal が表示されている Microsoft Edge ウィンドウで、 **[az801l05a-rsvault** Recovery Services コンテナー] ページの左側の垂直メニューの **[作業の開始]** セクションで、 **[バックアップ]** を選択します。
1. [**az801l05a-rsvault \|バックアップ]** ページで、次の設定を指定します。

   |設定| 値|
   |---|---|
   |ワークロードはどこで実行されていますか?|**オンプレミス**|
   |何をバックアップしますか?|**ファイルとフォルダー**|

1. [**az801l05a-rsvault \|バックアップ]** ページで、 **[インフラストラクチャの準備]** を選択します。
1. **[インフラストラクチャの準備]** ページで、 **[Windows Server または Windows クライアント用エージェントのダウンロード]** リンクを選択します。
1. ダウンロードが完了したら、Microsoft Edge の **[ダウンロード]** 通知で **[ファイルを開く]** リンクを選択します。 

   > **メモ：** これにより **[Microsoft Azure Recovery Services Agent セットアップ ウィザード]** が起動し、今回の場合ではそれにより **[サーバーの登録ウィザード]** が自動的に起動します。

1. **[Microsoft Azure Recovery Services Agent セットアップ ウィザード]** の **[インストール設定]** ページで、既定の設定を受け入れ、 **[次へ]** を選択します。
1. **[Microsoft Azure Recovery Services Agent セットアップ ウィザード]** の **[プロキシ構成]** ページで、既定の設定を受け入れ、 **[次へ]** を選択します。
1. **[Microsoft Azure Recovery Services Agent セットアップ ウィザード]** の **[Microsoft Update のオプトイン]** ページで、 **[Windows Update を使用しない]** を選択し、 **[次へ]** を選択します。
1. **[Microsoft Azure Recovery Services Agent セットアップ ウィザード]** の **[インストール]** ページで **[インストール]** を選択します。
1. インストールが完了したら、 **[Microsoft Azure Recovery Services Agent セットアップ ウィザード]** の **[インストール]** ページで **[登録処理を続行]** を選択します。 これにより、 **[サーバーの登録ウィザード]** が起動します。
1. Azure portal が表示されている Microsoft Edge ウィンドウに切り替え、 **[インフラストラクチャの準備]** ページで、 **[最新の Recovery Server エージェントを既にダウンロードしたか、使用している]** チェック ボックスをオンにして、 **[ダウンロード]** を選択します。
1. コンテナーの資格情報ファイルを開く、または保存するかどうかの確認を求めるメッセージが表示されたら、 **[保存]** を選択します。 これにより、コンテナーの資格情報ファイルがローカルの [ダウンロード] フォルダーに保存されます。
1. **[サーバーの登録ウィザード]** に戻り、 **[コンテナーの識別]** ページで **[参照]** を選択します。
1. **[コンテナー資格情報の選択]** ダイアログ ボックスで、 **[ダウンロード]** フォルダーを参照し、ダウンロードしたコンテナー資格情報ファイルを選択して、 **[開く]** を選択します。 次に、 **[次へ]** を選択して **[暗号化の設定]** ページを開きます。
1. **[サーバーの登録ウィザード]** の **[暗号化の設定]** ページで、 **[パスフレーズの生成]** を選択します。
1. **[サーバーの登録ウィザード]** の **[暗号化の設定]** ページで、 **[パスフレーズの保存先の入力]** ドロップダウン リストの横にある **[参照]** ボタンを選択します。
1. **[フォルダーの参照]** ダイアログ ボックスで、 **[この PC]** ノードを展開し、 **[ドキュメント]** サブフォルダーを選択して、 **[OK]** を選択します。
1. **[完了]** を選択し、 **[Microsoft Azure Backup]** の警告を確認し、 **[はい]** を選択して、登録が完了するまで待ちます。

   > **メモ:** 実稼働環境では、バックアップするサーバー以外のセキュリティで保護された場所にパスフレーズ ファイルを保存する必要があります。

1. **[サーバーの登録ウィザード]** の **[サーバーの登録]** ページで、パスフレーズ ファイルの場所に関する警告を確認し、 **[Microsoft Azure Recovery Services エージェントを起動する]** チェック ボックスがオンになっていることを確認して、 **[閉じる]** を選択します。 これにより、 **[Microsoft Azure Backup]** コンソールが自動的に開きます。

#### <a name="task-2-schedule-azure-backup"></a>タスク 2: Azure Backup のスケジュール設定

1. **SEA-SVR2** の **[Microsoft Azure Backup]** コンソールの [アクション] ウィンドウで、 **[バックアップのスケジュール]** を選択します。
1. **[バックアップのスケジュール ウィザード]** の **[作業の開始]** ページで、 **[次へ]** を選択します。
1. **[バックアップする項目の選択]** ページで、 **[項目の追加]** を選択します。
1. **[項目の選択]** ダイアログ ボックスで、**C:\\Windows\\ System32\\drivers\\etc\\** フォルダーを参照し、 **[hosts]** を選択して、 **[OK]** を選択します。
1. **[バックアップする項目の選択]** ページで、 **[次へ]** を選択します。
1. **[バックアップ スケジュールの選択]** ページで、 **[日]** オプションが選択されていることを確認し、 **[時刻を指定 (最大で 1 日に 3 回)]** ボックスの下の最初のドロップダウン リスト ボックスで、 **[午前 4 時 30 分]** を選択し、 **[次へ]** を選択します。
1. **[保持ポリシーの選択]** ページ で、既定値を受け入れ、 **[次へ]** を選択します。
1. **[初期バックアップの種類の選択]** ページ で、既定値を受け入れ、 **[次へ]** を選択します。
1. **[確認]** ページで、 **[完了]** を選択します。 バックアップ スケジュールが作成されたら、 **[閉じる]** を選択します。

#### <a name="task-3-perform-an-on-demand-backup"></a>タスク 3: オンデマンド バックアップの実行

> **メモ:** スケジュールされたバックアップを作成した後、オンデマンドでバックアップを実行するオプションが使用可能になります。

1. **[Microsoft Azure Backup]** コンソールの [アクション] ウィンドウで、 **[今すぐバックアップ]** を選択します。
1. **[今すぐバックアップ ウィザード]** の **[バックアップ項目の選択]** ページで、 **[ファイルとフォルダー]** オプションが選択されていることを確認し、 **[次へ]** を選択します。
1. **[バックアップの保持期限]** ページで、既定の設定を受け入れ、 **[次へ]** を選択します。
1. **[確認]** ページで、 **[バックアップ]** を選択します。
1. バックアップが完了したら、 **[閉じる]** を選択します。
1. **SEA-SVR2** で、Azure portal が表示されている [Microsoft Edge] ウィンドウに切り替え、 **[az801l05a-rsvault** Recovery Services コンテナー] ページに戻り、 **[バックアップ項目]** を選択します。 
1. **[az801l05a-rsvault \| バックアップ項目]** ページで、 **[Azure Backup エージェント]** エントリを選択します。
1. **[バックアップ項目 (Azure Backup エージェント)]** ページで、**sea-svr2.contoso.com** のドライブ **C** を参照するエントリがあることを確認します。

#### <a name="task-4-perform-file-recovery-by-using-azure-recovery-services-agent"></a>タスク 4: Azure Recovery Services エージェントを使用したファイルの回復の実行

1. **SEA-SVR2** で、ファイル エクスプローラーを開き、**C:\\Windows\\System32\\drivers\\etc\\** フォルダーを参照し、**hosts** ファイルを削除します。
1. [Microsoft Azure Backup] ウィンドウに切り替え、 **[データの回復]** を選択します。 これにより、 **[データの回復ウィザード]** が起動します。
1. **[データの回復ウィザード]** の **[作業の開始]** ページで、 **[このサーバー (sea-svr2.contoso.com)]** オプションが選択されていることを確認し、 **[次へ]** を選択します。
1. **[回復モードの選択]** ページ で、 **[個々のファイルおよびフォルダー]** オプションが 選択されていることを確認し、 **[次へ]** を選択 します。
1. **[ボリュームと日付の選択]** ページの **[ボリュームの選択]** ドロップダウン リストで **[C:]\\** を選択し、使用可能なバックアップの既定の選択を受け入れて、 **[マウント]** を選択します。 

   > **メモ:** マウント操作が完了するまで待ちます。 これには 2 分ほどかかる場合があります。

1. **[ファイルの参照と回復]** ページで、回復ボリュームのドライブ文字をメモし、 **[参照]** を選択して、**Robocopy** の使用に関するヒントを確認します。 
1. **[スタート]** を選択し、 **[Windows システム]** フォルダーを展開して、 **[コマンド プロンプト]** を選択します。
1. **[管理者: コマンド プロンプト]** ウィンドウで、次のコマンドを実行して **hosts** ファイルをコピーして元の場所に復元します (`<recovery_volume>` プレースホルダーは前に特定した回復ボリュームのドライブ文字に置き換えます)。

   ```cmd
   robocopy <recovery_volume>:\Windows\System32\drivers\etc C:\Windows\system32\drivers\etc hosts /r:1 /w:1
   ```

1. **[管理者: コマンド プロンプト]** ウィンドウ で、次のコマンドを実行して、ファイルが復元されたことを確認します。

   ```cmd
   dir C:\Windows\system32\drivers\etc\hosts
   ```

1. **[データの回復ウィザード]** に戻り、 **[ファイルの参照と回復]** ページで **[マウント解除]** を選択し、確認を求めるメッセージが表示されたら、 **[はい]** を選択します。 

## <a name="exercise-4-deprovisioning-the-azure-lab-environment"></a>演習 4: Azure ラボ環境のプロビジョニング解除

#### <a name="task-1-remove-the-protected-items"></a>タスク 1: 保護された項目の削除

1. **SEA-SVR2** で、Azure portal の **[バックアップ項目 (Azure Backup エージェント)]** ページが表示されている Microsoft Edge ウィンドウに切り替え、 **[sea-svr2.contoso.com]** のドライブ **C** を参照するエントリを選択します。
1. **C: \\[sea-svr2.contoso.com]** のページで、**sea-svr2.contoso.com** のリンクを選択します。
1. **[sea-svr2.contoso.com]** のページで **[削除]** . を選択します。 
1. **[削除]** ページ で、次の情報を指定し、 **[このサーバーに関連付けられている 1 つのバックアップ項目のバックアップ データがあります。[確認] をクリックすると、すべてのクラウド バックアップ データが完全に削除されるのを理解しています。この操作を元に戻すことはできません。この削除チェックボックスをオンにした場合、このサブスクリプションの管理者にアラートが送信されます]** というチェックボックスをオンにして、 **[削除]** を選択 します。

   |設定| 値|
   |---|---|
   |サーバー名の入力|**sea-svr2.contoso.com**|
   |理由|**使用停止**|
   |説明|**使用停止**|

1. **SEA-SVR2** で、Azure Portal を表示しているMicrosoft Edge で、 **[az801l05a-rsvault | レプリケートされた項目]** ページを参照し、 **[SEA-CORE1]** エントリを選択します。
1. **[SEA-CORE1]** のレプリケートされた項目のページで、ツールバーの省略記号を選択し、ドロップダウン メニューから **[レプリケーションの無効化]** を選択します。 
1. **[レプリケーションの無効化]** ページで、 **[レプリケーションを無効にして削除 (推奨)]** エントリが **[レプリケートされた項目の削除]** ドロップダウン リストに表示されるのを確認し、 **[フィードバックを提供しない]** チェック ボックスをオンにして、 **[OK]** を選択します。

#### <a name="task-2-delete-the-lab-resource-groups"></a>タスク 2: ラボ リソース グループの削除

1. **SEA-SVR2** で、Azure portal を表示している Microsoft Edge ウィンドウから、Azure portal の [Cloud Shell] ボタンを選択して [Azure Cloud Shell] ウィンドウを開きます。
1. **Bash** または **PowerShell** の選択を求めるメッセージが表示されたら、 **[PowerShell]** を選択します。

   > **メモ**: Cloud Shell を起動するのが初めてで、「**ストレージがマウントされていません**」というメッセージが表示される場合は、このラボで使用しているサブスクリプションを選択してから、**[ストレージの作成]** を選択します。

1. [Cloud Shell] ウィンドウで次を実行して、このラボで作成したすべてのリソース グループの一覧を表示します。

   ```powershell
   Get-AzResourceGroup -Name 'AZ801-L050*'
   ```

   > **メモ**: 出力に、このラボで作成したリソース グループのみが含まれていることを確認してください。 このグループは、このタスクで削除されます。

1. [Cloud Shell] ウィンドウで次のコマンドを実行して、このラボで作成されたすべてのリソース グループを削除します。

   ```powershell
   Get-AzResourceGroup -Name 'AZ801-L050*' | Remove-AzResourceGroup -Force -AsJob
   ```

   > **メモ:** このコマンドは非同期で実行されます ( *-AsJob* パラメーターによって決定されます)。そのため、同じ PowerShell セッション内で直後に別の PowerShell コマンドを実行できますが、リソース グループが実際に削除されるまでに数分かかります。