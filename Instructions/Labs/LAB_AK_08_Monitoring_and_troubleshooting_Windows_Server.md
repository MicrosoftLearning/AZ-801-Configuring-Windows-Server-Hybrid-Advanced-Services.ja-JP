---
lab:
  title: 'ラボ: Windows Server の監視とトラブルシューティング'
  type: Answer Key
  module: 'Module 8: Monitoring, performance, and troubleshooting'
ms.openlocfilehash: 5067b69c33fa81f9ba2d7d4efb10b717fe11924f
ms.sourcegitcommit: 9a51ea796ef3806ab9e7ec1ff75034b2f929ed2a
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/28/2022
ms.locfileid: "137907167"
---
# <a name="lab-answer-key-monitoring-and-troubleshooting-windows-server"></a>ラボの回答キー: Windows Server の監視とトラブルシューティング

### <a name="exercise-1-establishing-a-performance-baseline"></a>演習 1: パフォーマンス ベースラインの確立

> **注**: データ コレクター セットを開始した後に、結果が表示されるまでに 10 分の遅延が発生する場合があります。

#### <a name="task-1-create-and-start-a-data-collector-set"></a>タスク 1: データ コレクター セットを作成して開始する

1. **SEA-SVR2** に接続し、必要であれば、パスワード "**Pa55w.rd**" を使用して **CONTOSO\\Administrator** としてサインインします。
1. **SEA-SVR2** で、 **[スタート]** の横にある **[ここに検索語句を入力してください]** テキスト ボックスに「**Perf**」と入力した後、 **[関連度順]** ボックスの一覧で **[パフォーマンス モニター]** を選択します。
1. パフォーマンス モニターで **[データ コレクター セット]** ノードを展開し、 **[ユーザー定義]** を選択します。
1. **[ユーザー定義]** を右クリックしてコンテキスト メニューを表示し、 **[新規]** 、 **[データ コレクター セット]** の順に選択します。 これにより、**新しいデータ コレクター セットの作成** ウィザードが起動します。
1. **新しいデータ コレクター セットの作成** ウィザードの **[この新しいデータ コレクター セットの作成方法を選択してください。]** ページで **[名前]** ボックスに「**SEA-SVR2 Performance**」と入力します。
1. **[手動で作成する (詳細)]** オプションを選択した後、 **[次へ]** をクリックします。
1. **[含めるデータの種類を選択してください。]** ページで **[パフォーマンス カウンター]** チェックボックスをオンにし、 **[次へ]** をクリックします。
1. **[記録するパフォーマンス カウンターを選択してください。]** ページで **[追加]** をクリックします。
1. **[使用可能なカウンター]** ボックスの一覧で **[Processor]** を展開し、 **[% Processor Time]** を選択します。次に、 **[選択したオブジェクトのインスタンス]** セクションで **[_Total]** エントリが選択されていることを確認し、 **[追加]** をクリックします。
1. **[使用可能なカウンター]** ボックスの一覧で **[Memory]** を展開し、 **[Pages/sec]** 、 **[追加]** の順にクリックします。
1. **[使用可能なカウンター]** ボックスの一覧で **[PhysicalDisk]** を展開し、 **[% Disk Time]** を選択します。次に、 **[選択したオブジェクトのインスタンス]** セクションで **[_Total]** エントリが選択されていることを確認し、 **[追加]** をクリックします。
1. **[Avg. Disk Queue Length]** を選択し、 **[選択したオブジェクトのインスタンス]** で **[_Total]** エントリが選択されていることを確認した後、 **[追加]** をクリックします。
1. **[使用可能なカウンター]** ボックスの一覧で **[System]** を展開し、 **[Processor Queue Length]** 、 **[追加]** の順にクリックします。
1. **[使用可能なカウンター]** ボックスの一覧で **[Network Interface]** を展開し、 **[Bytes Total/sec]** を選択します。次に、 **[選択したオブジェクトのインスタンス]** セクションで **[<All instances>]** エントリが選択されていることを確認し、 **[追加]** 、 **[OK]** の順にクリックします。
1. **[記録するパフォーマンス カウンターを選択してください。]** ページで **[サンプルの間隔]** ボックスに「**1**」と入力し、 **[次へ]** をクリックします。
1. **[データの保存場所を選択してください。]** ページで **[次へ]** をクリックします。
1. **[データ コレクター セットを作成しますか?]** ページで **[保存して閉じる]** オプションを選択していることを確認した後、 **[完了]** をクリックします。
1. パフォーマンス モニターの結果ページで **[SEA-SVR2 パフォーマンス]** を右クリックしてコンテキスト メニューを表示し、 **[開始]** を選択します。

#### <a name="task-2-create-a-typical-workload-on-the-server"></a>タスク 2: 一般的なワークロードをサーバーで作成する

1. **SEA-SVR2** で **[スタート]** をクリックし、[Windows PowerShell] を右クリックしてコンテキスト メニューを表示した後、 **[管理者として実行]** を選択します。
1. 特定のサイズのファイルを作成するには、Windows PowerShell のコマンド プロンプトで次のコマンドを入力し、Enter キーを押します。

   ```powershell
   fsutil file createnew bigfile 104857600
   ```

1. 新しく作成したファイルを、**SEA-DC1** の **C** ドライブのルートにコピーするには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   Copy-Item -Path .\bigfile -Destination \\SEA-DC1.contoso.com\c$\ -Force
   ```

1. **SEA-DC1** の **C** ドライブのルートから、現在の作業ディレクトリに、このファイルをコピーするには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   Copy-Item -Path \\SEA-DC1.contoso.com\c$\bigfile -Destination .\bigfile2 -Force
   ```

1. 現在の作業ディレクトリで両方のファイルを削除するには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   Remove-Item -Path .\bigfile* -Force
   ```

1. **SEA-DC1** の **C** ドライブのルートでファイルを削除するには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   Remove-Item -Path \\SEA-DC1.contoso.com\c$\bigfile -Force
   ```

1. Windows PowerShell ウィンドウは開いたままにしておきます。

#### <a name="task-3-analyze-the-collected-data"></a>タスク 3: 収集したデータを分析する

1. **SEA-SVR2** で、パフォーマンス モニターに切り替えます。
1. ナビゲーション ウィンドウで、 **[SEA-SVR2 パフォーマンス]** を右クリックしてコンテキスト メニューを表示し、 **[停止]** を選択 します。
1. パフォーマンス モニターのナビゲーション ウィンドウで **[レポート]** 、 **[ユーザー定義]** 、 **[SEA-SVR2 パフォーマンス]** の順に展開し、 **[SEA-SVR2\_*DateTime*-000001]** (*DateTime* は、現在のタイムスタンプを指定します) を選択した後、レポート データを確認します。
1. メニュー バーで **[グラフの種類の変更]** を選択するか、Ctrl + G キーを押し、次に **[レポート]** を選択します。
1. レポートに一覧表示される値を記録して、後で分析できるようにします。 記録される値は次のとおりです。

   - **Memory\\Pages/sec**
   - **Network Interface\\Bytes Total/sec**
   - **PhysicalDisk\\% Disk Time**
   - **PhysicalDisk\\Avg. Disk Queue Length**
   - **Processor\\% Processor Time**
   - **System\\Processor Queue Length**

### <a name="exercise-2-identifying-the-source-of-a-performance-problem"></a>演習 2: パフォーマンス問題の原因の特定

#### <a name="task-1-create-additional-workload-on-the-server"></a>タスク 1: 追加のワークロードをサーバーで作成する

1. **SEA-SVR2** でエクスプローラーを開きます。
1. エクスプローラーで **C :\Labfiles\Lab08** を参照します。
1. **CPUSTRES64.EXE** をダブルクリックするか、選択して Enter キーを押します。

   > **注**: **CPUSTRES64.EXE** は SysInternals ユーティリティです。これを使用すると、ループ内で最大 64 のスレッドを実行して CPU アクティビティをシミュレートできます。

1. **[CPUSTRESS 使用許諾契約書]** ダイアログ ボックスで **[同意する]** を選択します。
1. **[CPU ストレス]** ダイアログ ボックスで、実行中のスレッドの一覧の先頭にある、強調表示されたスレッドを右クリックしてコンテキスト メニューを表示し、 **[アクティビティ レベル]** 、 **[ビジー (75%)]** の順に選択します。

#### <a name="task-2-capture-performance-data-by-using-a-data-collector-set"></a>タスク 2: データ コレクター セットを使用してパフォーマンス データをキャプチャする

1. **SEA-SVR2** で、パフォーマンス モニターに切り替えます。
1. パフォーマンス モニターで **[データ コレクター セット]** を展開し、 **[ユーザー定義]** を選択します。
1. 結果ウィンドウで **[SEA-SVR2 パフォーマンス]** を右クリックしてコンテキスト メニューを表示し、 **[開始]** を選択 します。

   > **注**: データ キャプチャが行われるように 1 分間、待ってください。

#### <a name="task-3-remove-the-workload-and-review-the-performance-data"></a>タスク 3: ワークロードを削除し、パフォーマンス データを確認する

1. **SEA-SVR2** で **[CPU ストレス]** ダイアログ ボックスに切り替え、このダイアログ ボックスを閉じます。 
1. パフォーマンス モニターに切り替えます。
1. ナビゲーション ウィンドウで、 **[SEA-SVR2 パフォーマンス]** を右クリックしてコンテキスト メニューを表示し、 **[停止]** を選択 します。
1. パフォーマンス モニターのナビゲーション ウィンドウで **[レポート]** 、 **[ユーザー定義]** 、 **[SEA-SVR2 パフォーマンス**] の順に展開し、[**SEA-SVR2\_*DateTime*-000002]** (*DateTime* は、現在のタイムスタンプを指定します) を選択した後、レポート データを確認します。
1. メニュー バーで **[グラフの種類の変更]** を選択するか、Ctrl + G キーを押し、次に **[レポート]** を選択します。
1. 前回と同様に、レポートに一覧表示される値を記録します。 記録される値は次のとおりです。

   - **Memory\\Pages/sec**
   - **Network Interface\\Bytes Total/sec**
   - **PhysicalDisk\\% Disk Time**
   - **PhysicalDisk\\Avg. Disk Queue Length**
   - **Processor\\% Processor Time**
   - **System\\Processor Queue Length**

### <a name="exercise-3-viewing-and-configuring-centralized-event-logs"></a>演習 3: 一元化されたイベント ログの表示と構成

#### <a name="task-1-configure-subscription-prerequisites"></a>タスク 1: サブスクリプションの前提条件を構成する

1. **SEA-SVR2** で Windows PowerShell に切り替えます。
1. **SEA-SVR2** に転送されるイベントのサブスクリプションの作成と管理を有効にするには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   WECUtil qc /q
   ```

1. イベント ソースとコレクターのローカルの日付と時刻が同期されていることを確認するには、次のコマンドを入力し、Enter を押します。

   ```powershell
   w32tm /resync /computer:SEA-DC1.contoso.com
   ```

1. Kerberos 認証の問題が発生した場合に WinRM の接続を許可するには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   Set-Item WSMan:localhost\client\trustedhosts -Value *.contoso.com -Force
   ```

1. **SEA-DC1** への PowerShell リモート処理セッションを確立するには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   Enter-PSSession -ComputerName SEA-DC1.contoso.com
   ```

1. **SEA-DC1** で Windows リモート管理 (WinRM) が有効になっていることを確認するには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   winrm qc
   ```

   > **注**: WinRM サービスが既に実行されていて、リモート管理用に設定されていることを確認してください。

1. **SEA-DC1** で、高度なセキュリティ規則を備えた、関連する Windows Defender ファイアウォールが有効になっていることを確認するには、次のコマンドを入力し、Enter キーを押します。

   ```powershell
   Set-NetFirewallRule -DisplayGroup 'Remote Event Log Management' -Enabled True -Profile Domain -PassThru
   ```

   > **注**: Windows PowerShell ウィンドウを、開いたままにしておきます。

1. **SEA-SVR2** で、 **[スタート]** の横にある **[ここに検索語句を入力してください]** テキスト ボックスに「**Active**」と入力した後、 **[関連度順]** ボックスの一覧で **[Active Directory ユーザーとコンピューター]** を選択します。
1. **[Active Directory ユーザーとコンピューター]** コンソールで **[Builtin]** コンテナーを選択します。 
1. **[Builtin]** コンテナーで **[Event Log Readers]** グループを選択します。
1. **[Event Log Readers]** グループを右クリックしてコンテキスト メニューを表示し、 **[プロパティ]** を選択します。次に **[Event Log Readers のプロパティ]** ダイアログ ボックスで **[メンバー]** タブをクリックします。
1. **[メンバー]** タブで **[追加]** を選択します。
1. **[ユーザー、連絡先、コンピューター、サービス アカウント、またはグループの選択]** ダイアログ ボックスで **[オブジェクトの種類]** を選択します。
1. **[オブジェクトの種類]** ダイアログ ボックスで **[コンピューター]** チェックボックスをオンにしてから、 **[OK]** をクリックします。
1. **[ユーザー、コンピューター、サービス アカウント、またはグループの選択]** ダイアログ ボックスで **[選択するオブジェクト名を入力してください]** ボックスに「**SEA-SVR2**」と入力し、 **[OK]** をクリックします。
1. **[Event Log Readers のプロパティ]** ダイアログ ボックスで **[OK]** をクリックします。

#### <a name="task-2-create-a-subscription-and-verify-the-results"></a>タスク 2: サブスクリプションを作成し、結果を確認する

1. **SEA-SVR2** で、 **[スタート]** の横にある **[ここに検索語句を入力してください]** テキスト ボックスに「**Event**」と入力した後、 **[関連度順]** ボックスの一覧で **[イベント ビューアー]** を選択します。
1. **イベント ビューアー** のナビゲーション ウィンドウで **[サブスクリプション]** を選択します。
1. **[サブスクリプション]** を右クリックしてコンテキスト メニューを表示し、 **[サブスクリプションの作成]** を選択します。
1. **[サブスクリプションのプロパティ]** ダイアログ ボックスで **[サブスクリプション名]** ボックスに「**SEA-DC1 Events**」と入力します。
1. **[コレクターによる開始]** オプションを選択していることを確認してから、 **[コンピューターの選択]** を選択します。
1. **[コンピューター]** ダイアログ ボックスで **[ドメイン コンピューターの追加]** を選択します。
1. **[コンピューターの選択]** ダイアログ ボックスで **[選択するオブジェクト名を入力してください]** ボックスに「**SEA-DC1**」と入力し、 **[OK]** をクリックします。
1. **[コンピューター]** ダイアログ ボックスで **[OK]** をクリックします。
1. **[サブスクリプションのプロパティ – SEA-DC1 のイベント]** ダイアログ ボックスで **[イベントの選択]** を選択します。
1. **[ログ作成日時]** ボックスの一覧で **[過去 24 時間]** を選択します。
1. **[クエリ フィルター]** ダイアログ ボックスで、 **[重大]** 、 **[エラー]** 、 **[警告]** 、 **[情報]** の各チェックボックスをオンにします。
1. **[イベント ログ]** ボックスの一覧で **[Windows のログ]** を展開し、 **[システム]** および **[アプリケーション]** チェックボックスをオンにします。
1. **[クエリ フィルター]** ダイアログ ボックスで **[OK]** をクリックします。
1. **[サブスクリプションのプロパティ – SEA-DC1 のイベント]** ダイアログ ボックスに戻り、 **[OK]** をクリックします。
1. **SEA-SVR2** で、 **[イベント ビューアー]** ウィンドウに切り替え、ナビゲーションウィンドウで **[Windows のログ]** を展開します。
1. **[転送済みイベント]** を選択し、転送されたイベントに、**SEA-DC1** 上で生成されたイベントが含まれることを確認します。
